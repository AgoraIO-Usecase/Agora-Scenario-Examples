## 声网互动游戏Demo(直播间嵌入游戏)

### 1. 场景说明

目前支持游戏:
    * 你画我猜

目前设计的游戏步骤:
    1. 主播A开始直播（需要监听房间内RTM信息）
    2. 主播B开始直播（需要监听房间内RTM信息）
    3. A邀请B（加入对方RTM频道，修改对方频道内同步字段，并监听）
    4. B同意邀请（监听到信息改变，改变状态为'同意'）
    5. A、B各自加载WebView（监听到信息改变，添加WebView到界面，加载游戏主页并通过URL传入必需参数）
    6. A、B各自开始屏幕录制发第二路流
    7. A、B分别加入对方RTC频道拉取对方视频流
    8. A、B直播间内观众分别加入对方频道，加载双方主播视频流及本直播间屏幕录制视频流

相关技术方案：
    1. 数据同步及监听
    > 基于RTM封装的SyncManager，但RTM不支持监听单个属性修改，所以SyncManager目前是一个频道存一个属性

    2. 音视频互通
    > 声网RTC SDK 4.0.0 preview

    3. 屏幕录制
    > 大重构定制SDK (包含 RTC 功能)

技术弊端：
    1. SyncManager
        * RTM限制一人最多加入20频道，按照技术方案一个字段需要一个频道，有隐藏风险
        * 重复加入频道会报错，所以需要记住当前状态并记得退出，但复杂业务下很难考虑到所有情况，且污染UI层代码逻辑
        * SyncManager 为半成品，边写业务边迭代，无短期或长期规划，无技术亮点，仅为完成需求赶出来的一个缝合怪。
    2. 游戏画面分享
        * 当前确定的方案为屏幕录制，一是流量消耗加倍，二是逻辑复杂，三是要求游戏过程中不能遮挡游戏画面（主要是礼物类互动道具）
        * 游戏画面受限，很难有好的游戏体验
        * 方案为录制全屏，给SDK传参数指定区域，SDK裁剪完推流。一是耗电严重，二是占用过多资源影响APP甚至游戏流畅度，三是裁剪功能未经测试有不可预知风险
    3. 音视频通话
        * 当前方案A直播间所有人会拉取B直播间画面，需要A所有人加入B频道，且作出摄像头视频流和屏幕流甚至其他视频流的区分判断。